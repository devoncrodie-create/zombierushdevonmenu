--// Services
local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")

local player = Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")
local char = player.Character or player.CharacterAdded:Wait()
local humRoot = char:WaitForChild("HumanoidRootPart")

--// Settings
local zombieStorage = workspace:WaitForChild("ZombieStorage")
local followOffset = 1 -- studs above zombie
local followSpeed = 0.15

--// State
local hitboxEnabled = true
local followEnabled = true
local hitboxSize = Vector3.new(20,20,20)

--// GUI
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "ZombieMenuGui"
screenGui.Parent = playerGui

-- Main frame
local frame = Instance.new("Frame")
frame.Size = UDim2.new(0, 200, 0, 280)
frame.Position = UDim2.new(0.05,0,0.05,0)
frame.BackgroundColor3 = Color3.fromRGB(40,40,40)
frame.BorderSizePixel = 0
frame.Parent = screenGui
frame.Active = true
frame.Draggable = true

-- Title label
local titleLabel = Instance.new("TextLabel")
titleLabel.Size = UDim2.new(0, 200, 0, 30)
titleLabel.Position = UDim2.new(0, 0, 0, 0)
titleLabel.BackgroundColor3 = Color3.fromRGB(60,60,60)
titleLabel.TextColor3 = Color3.new(1,1,1)
titleLabel.Font = Enum.Font.SourceSansBold
titleLabel.TextScaled = true
titleLabel.Text = "Devon's Menu"
titleLabel.Parent = frame

-- Hitbox Toggle Button
local hitboxButton = Instance.new("TextButton")
hitboxButton.Size = UDim2.new(0, 180, 0, 40)
hitboxButton.Position = UDim2.new(0, 10, 0, 40)
hitboxButton.Text = "Hitbox: ON"
hitboxButton.BackgroundColor3 = Color3.fromRGB(0, 200, 0)
hitboxButton.TextColor3 = Color3.new(1,1,1)
hitboxButton.Parent = frame

hitboxButton.MouseButton1Click:Connect(function()
	hitboxEnabled = not hitboxEnabled
	if hitboxEnabled then
		hitboxButton.Text = "Hitbox: ON"
		hitboxButton.BackgroundColor3 = Color3.fromRGB(0,200,0)
	else
		hitboxButton.Text = "Hitbox: OFF"
		hitboxButton.BackgroundColor3 = Color3.fromRGB(200,0,0)
	end
end)

-- Follow Toggle Button
local followButton = Instance.new("TextButton")
followButton.Size = UDim2.new(0,180,0,40)
followButton.Position = UDim2.new(0,10,0,90)
followButton.Text = "Follow: ON"
followButton.BackgroundColor3 = Color3.fromRGB(0,200,0)
followButton.TextColor3 = Color3.new(1,1,1)
followButton.Parent = frame

followButton.MouseButton1Click:Connect(function()
	followEnabled = not followEnabled
	if followEnabled then
		followButton.Text = "Follow: ON"
		followButton.BackgroundColor3 = Color3.fromRGB(0,200,0)
	else
		followButton.Text = "Follow: OFF"
		followButton.BackgroundColor3 = Color3.fromRGB(200,0,0)
	end
end)

-- Follow speed slider
local speedLabel = Instance.new("TextLabel")
speedLabel.Size = UDim2.new(0, 180, 0, 30)
speedLabel.Position = UDim2.new(0, 10, 0, 140)
speedLabel.Text = "Follow Speed: "..followSpeed
speedLabel.TextColor3 = Color3.new(1,1,1)
speedLabel.BackgroundTransparency = 1
speedLabel.Parent = frame

local speedSlider = Instance.new("TextButton")
speedSlider.Size = UDim2.new(0, 180, 0, 20)
speedSlider.Position = UDim2.new(0, 10, 0, 170)
speedSlider.Text = "Drag to change"
speedSlider.BackgroundColor3 = Color3.fromRGB(100,100,100)
speedSlider.TextColor3 = Color3.new(1,1,1)
speedSlider.Parent = frame

local mouse = player:GetMouse()
local dragging = false

speedSlider.MouseButton1Down:Connect(function() dragging = true end)
mouse.Button1Up:Connect(function() dragging = false end)

mouse.Move:Connect(function()
	if dragging then
		local rel = math.clamp(mouse.X - speedSlider.AbsolutePosition.X, 0, speedSlider.AbsoluteSize.X)
		followSpeed = 0.05 + (rel / speedSlider.AbsoluteSize.X) * 0.5
		speedLabel.Text = "Follow Speed: "..string.format("%.2f", followSpeed)
	end
end)

-- Hitbox size slider
local sizeLabel = Instance.new("TextLabel")
sizeLabel.Size = UDim2.new(0, 180, 0, 30)
sizeLabel.Position = UDim2.new(0,10,0,200)
sizeLabel.Text = "Hitbox Size: "..hitboxSize.X
sizeLabel.TextColor3 = Color3.new(1,1,1)
sizeLabel.BackgroundTransparency = 1
sizeLabel.Parent = frame

local sizeSlider = Instance.new("TextButton")
sizeSlider.Size = UDim2.new(0,180,0,20)
sizeSlider.Position = UDim2.new(0,10,0,230)
sizeSlider.Text = "Drag to change"
sizeSlider.BackgroundColor3 = Color3.fromRGB(100,100,100)
sizeSlider.TextColor3 = Color3.new(1,1,1)
sizeSlider.Parent = frame

local draggingSize = false
sizeSlider.MouseButton1Down:Connect(function() draggingSize = true end)
mouse.Button1Up:Connect(function() draggingSize = false end)

mouse.Move:Connect(function()
	if draggingSize then
		local rel = math.clamp(mouse.X - sizeSlider.AbsolutePosition.X, 0, sizeSlider.AbsoluteSize.X)
		local s = 5 + (rel / sizeSlider.AbsoluteSize.X) * 50
		hitboxSize = Vector3.new(s,s,s)
		sizeLabel.Text = "Hitbox Size: "..string.format("%.1f", s)
	end
end)

-- Smooth movement
local function moveSmoothly(targetCFrame)
	if followEnabled and humRoot then
		local tween = TweenService:Create(
			humRoot,
			TweenInfo.new(followSpeed, Enum.EasingStyle.Linear, Enum.EasingDirection.Out),
			{CFrame = targetCFrame}
		)
		tween:Play()
	end
end

-- Move above zombie
local function moveAboveZombie(model)
	if followEnabled and model and model:FindFirstChild("HumanoidRootPart") then
		moveSmoothly(model.HumanoidRootPart.CFrame * CFrame.new(0, 1, 0))
	end
end

-- Update hitbox and forward hits to Humanoid
local function updateHitbox(zombie)
	local hrp = zombie:FindFirstChild("HumanoidRootPart")
	local humanoid = zombie:FindFirstChildWhichIsA("Humanoid")
	if hrp and humanoid then
		if hitboxEnabled then
			local hitbox = zombie:FindFirstChild("ZombieHitbox")
			if not hitbox then
				hitbox = Instance.new("Part")
				hitbox.Name = "ZombieHitbox"
				hitbox.Anchored = true
				hitbox.CanCollide = false
				hitbox.Transparency = 0.5
				hitbox.BrickColor = BrickColor.new("Really red")
				hitbox.Parent = zombie

				-- Forward hits to Humanoid
				hitbox.Touched:Connect(function(hit)
					if humanoid and hit.Parent:FindFirstChildWhichIsA("Tool") then
						humanoid:TakeDamage(1) -- Adjust damage as needed
					end
				end)
			end
			hitbox.Size = hitboxSize
			hitbox.CFrame = hrp.CFrame
		else
			local existing = zombie:FindFirstChild("ZombieHitbox")
			if existing then existing:Destroy() end
		end
	end
end

-- Update zombies loop
task.spawn(function()
	while true do
		for _, zombie in ipairs(zombieStorage:GetChildren()) do
			if zombie:IsDescendantOf(zombieStorage) then
				updateHitbox(zombie)
			end
		end
		task.wait(0.1)
	end
end)

-- Follow zombies loop
task.spawn(function()
	while true do
		if followEnabled then
			local zombies = zombieStorage:GetChildren()
			table.sort(zombies, function(a,b) return a.Name < b.Name end)
			for _, zombie in ipairs(zombies) do
				if zombie:IsDescendantOf(zombieStorage) and zombie:FindFirstChild("HumanoidRootPart") then
					repeat
						if not zombie:IsDescendantOf(zombieStorage) then break end
						moveAboveZombie(zombie)
						task.wait(0.1)
					until not zombie:IsDescendantOf(zombieStorage)
				end
			end
		end
		task.wait(0.1)
	end
end)
